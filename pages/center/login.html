<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<meta name="HandheldFriendly" content="true"/>
		<!--<meta name="MobileOptimized" content="320"/>-->
		<title>求职通登陆</title>
		<link href="../../css/mui.css" rel="stylesheet"/>
	    <link rel="stylesheet" href="../../css/iconfont.css" />
	    <link rel="stylesheet" href="../../css/common.css" />
	    <link href="../../css/mui.picker.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
	    <link rel="stylesheet" href="../../css/login/login.css" />
		<style>
			.input {
				border: 1px solid rgba(0, 0, 0, .2);
				/*border-radius: 3px;*/
				border-left: none;
				border-right: none;
				height: 40px;
				line-height: 40px;
				padding-left: 15px;
				color: #000;
				font-size: 17px;
			}
			.input input {
				margin-left: 10px;
			}
		</style>
	</head>
	<body>
		<!-- 顶部标题 公共模块 start -->
		<header class="mui-bar mui-bar-nav head">
			<a href="#" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left white"></a>
			<h1 id="title" class="mui-title header">求职通登陆</h1>
		</header>
		<!-- 顶部标题 公共模块 end -->
		<!-- 公告正文部分 start -->
		<div class="mui-content" id="login_content" style="display: block;">
			<div id="slider" class="mui-slider">
				<div id="sliderSegmentedControl"  class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
						<div class="mui-scroll mui-text-center">
							<a class="mui-control-item mui-active student" href="#type1">
								东北师范大学用户
							</a>
							<a class="mui-control-item other" href="#type2">
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;其他用户&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							</a>
						</div>
				</div>
				<div class="mui-slider-group">
					<div id="type1" class="mui-slider-item mui-control-content mui-active">
						<form class="mui-content-padded" id="user1">
							<input type="text" name="username" placeholder="学号" />
							<input type="password" name="password" placeholder="密码" />
							<!--<p>
								<a href="forget_password.html" class="mui-pull-right grey">忘记密码?</a>
							</p>-->
							<button type="submit" id="submit1" class="mui-btn mui-btn-block submit" value="1">立即登陆</button>
						</form>
						<p class="mui-text-center">
							<a href="register.html" class="black">&nbsp;</a>
						</p>
						<p class="mui-text-center white-grey mui-content-padded">
							<span class="login-other">其他方式登录</span>
						</p>
					</div>
					<div id="type2" class="mui-slider-item mui-control-content">
						<form class="mui-content-padded" id="user2">
							<input type="text" name="username" placeholder="账号" />
							<input type="password" name="password" placeholder="密码" />
							<p>
								<a href="forget_password.html" class="mui-pull-right grey">忘记密码?</a>
							</p>
							<button type="submit" id="submit2" class="mui-btn mui-btn-block submit" value="2">立即登陆</button>
						</form>
						<p class="mui-text-center">
							<a href="register.html" class="black" open-type="common">注册新账号</a>
						</p>
						<p class="mui-text-center white-grey mui-content-padded">
							<span class="login-other">其他方式登录</span>
						</p>
					</div>
				</div>
			</div>
			<div id="dcontent" class="dcontent oauth-area">
				<div id="oauth"></div>
			</div>
			<div id="output" style="display: none;" ></div>
		</div>
		
		<div id="study_content" style="display: none; padding-top: 50px;">
			<h5 style="margin-left: 25px;">请完善您的个人信息,否则无法登陆</h3>
			<form id="study_form" class="mui-content-padded">
				<div class="mui-input-group">
					<div class="mui-input-row">
						<label>姓名</label>
						<!--<input type="text" id="J_user_id" name="user_id" style="display: none;" value="" />-->
						<input type="text" id="J_username" name="username" class="mui-input-clear" placeholder="姓名">
					</div>
					<div class="mui-input-row">
						<label>就读学校</label>
						<select name="school_name" class="" style="border: 1px solid #aaaaaa;">
		                    <option value="0">请选择就读学校</option>
		                    <option value="1">东北师范大学</option>
		                    <option value="2">吉林师范大学</option>
		                    <option value="3">辽宁师范大学</option>
		                    <option value="4">长春师范大学</option>
		                    <option value="5">哈尔滨师范大学</option>
		                    <option value="6">内蒙古民族大学</option>
		                    <option value="7">东北林业大学</option>
		                    <option value="8">佳木斯大学</option>
		                    <option value="9">齐齐哈尔大学</option>
		                    <option value="10">哈尔滨学院</option>
		                    <option value="11">鹤岗师范高等专科学校</option>
		                    <option value="12">牡丹江师范学院</option>
		                    <option value="13">大庆师范学院</option>
		                    <option value="14">哈尔滨体育学院</option>
		                    <option value="15">北华大学</option>
		                    <option value="16">吉林工程技术师范学院</option>
		                    <option value="17">通化师范学院</option>
		                    <option value="18">长春大学</option>
		                    <option value="19">白城师范学院</option>
		                    <option value="20">延边大学</option>
		                    <option value="21">吉林体育学院</option>
		                    <option value="22">沈阳师范大学</option>
		                    <option value="23">鞍山师范学院</option>
		                    <option value="24">渤海大学</option>
		                    <option value="25">沈阳大学</option>
		                    <option value="26">赤峰学院</option>
		                    <option value="27">绥化学院</option>
		                    <option value="28">呼伦贝尔学院</option>
		                    <option value="other">其它</option>
		               </select>
		            </div>
		            
		            <div class="mui-input-row">
						<label>开始年份</label>
						<select name="yearStart" class="">	
		                   <option value="0">开始年份</option>
					       <option value="2019">2019</option>
					       <option value="2018">2018</option>
					       <option value="2017">2017</option>
					       <option value="2016">2016</option>
					       <option value="2015">2015</option>
					       <option value="2014">2014</option>
					       <option value="2013">2013</option>
					       <option value="2012">2012</option>
					       <option value="2011">2011</option>
					       <option value="2010">2010</option>
					       <option value="2009">2009</option>
					       <option value="2008">2008</option>
					       <option value="2007">2007</option>
					       <option value="2006">2006</option>
					       <option value="2005">2005</option>
					       <option value="2004">2004</option>
					       <option value="2003">2003</option>
					       <option value="2002">2002</option>
					       <option value="2001">2001</option>
					       <option value="2000">2000</option>
					       <option value="1999">1999</option>
					       <option value="1998">1998</option>
					       <option value="1997">1997</option>
					       <option value="1996">1996</option>
					       <option value="1995">1995</option>
					       <option value="1994">1994</option>
					       <option value="1993">1993</option>
					       <option value="1992">1992</option>
					       <option value="1991">1991</option>
					       <option value="1990">1990</option>
					       <option value="1989">1989</option>
					       <option value="1988">1988</option>
					       <option value="1987">1987</option>
					       <option value="1986">1986</option>
					       <option value="1985">1985</option>
					       <option value="1984">1984</option>
					       <option value="1983">1983</option>
					       <option value="1982">1982</option>
					       <option value="1981">1981</option>
					       <option value="1980">1980</option>
						</select> 
		            </div>
		            
		            <div class="mui-input-row">
						<label>结束年份</label>
						<select name="yearEnd" class="">	
		                   <option value="0">结束年份</option>
					       <option value="2019">2019</option>
					       <option value="2018">2018</option>
					       <option value="2017">2017</option>
					       <option value="2016">2016</option>
					       <option value="2015">2015</option>
					       <option value="2014">2014</option>
					       <option value="2013">2013</option>
					       <option value="2012">2012</option>
					       <option value="2011">2011</option>
					       <option value="2010">2010</option>
					       <option value="2009">2009</option>
					       <option value="2008">2008</option>
					       <option value="2007">2007</option>
					       <option value="2006">2006</option>
					       <option value="2005">2005</option>
					       <option value="2004">2004</option>
					       <option value="2003">2003</option>
					       <option value="2002">2002</option>
					       <option value="2001">2001</option>
					       <option value="2000">2000</option>
					       <option value="1999">1999</option>
					       <option value="1998">1998</option>
					       <option value="1997">1997</option>
					       <option value="1996">1996</option>
					       <option value="1995">1995</option>
					       <option value="1994">1994</option>
					       <option value="1993">1993</option>
					       <option value="1992">1992</option>
					       <option value="1991">1991</option>
					       <option value="1990">1990</option>
					       <option value="1989">1989</option>
					       <option value="1988">1988</option>
					       <option value="1987">1987</option>
					       <option value="1986">1986</option>
					       <option value="1985">1985</option>
					       <option value="1984">1984</option>
					       <option value="1983">1983</option>
					       <option value="1982">1982</option>
					       <option value="1981">1981</option>
					       <option value="1980">1980</option>
						</select> 
		            </div>
		              
		            <div class="mui-input-row">
						<label>院系</label>
						<input type="text" name="deparment" class="mui-input-clear" placeholder="院系" required />
					</div>
				
					<div class="mui-input-row">
						<label>专业</label>
						<input type="text" name="major_name" class="mui-input-clear" placeholder="专业" required />
					</div>
					
					<div class="mui-input-row">
						<label>生源地</label>
						<a id='showCityPicker' class="" type='button' style="display: inline-block;color:#000;margin-top: 10px;width: 130px;">请选择...</a>
						<a id='cityResult' style="display: none;"></a>
		            </div>
			  </div>
			    
			    <p>&nbsp;</p>
			    
			    <h5 class="mui-content-padded">性别</h5>
				<div class="mui-input-group">
					<div class="mui-input-row mui-radio">
						<label>男</label>
						<input name="gender" value="1" type="radio" checked />
					</div>
					<div class="mui-input-row mui-radio">
						<label>女</label>
						<input name="gender" value="0" type="radio" />
					</div>

				</div>
				<!--<div class="input">
					<span style="margin-right: 55px;">性别</span>
					<input type="radio" name="gender" value="1" checked /><label>男</label>
					<input type="radio" name="gender" value="0" /><label>女</label>
				</div>-->
				
				<p>&nbsp;</p>
				
			    <h5 class="mui-content-padded">学历</h5>
			    <div class="mui-input-group">
				    <div class="mui-input-row mui-radio">
						<label>本科</label>
						<input type="radio" name="degree" value="1" checked />
					</div>
					<div class="mui-input-row mui-radio">
						<label>硕士</label>
						<input type="radio" name="degree" value="2" />
					</div>
					<div class="mui-input-row mui-radio">
						<label>博士</label>
						<input type="radio" name="degree" value="3" />
					</div>
					<div class="mui-input-row mui-radio">
						<label>专科</label>
						<input type="radio" name="degree" value="4" />
					</div>
					<div class="mui-input-row mui-radio">
						<label>其它</label>
						<input type="radio" name="degree" value="5" />
					</div>
				</div>
				

				
				
				
				<button id="J_studysub" type="submit" class="mui-btn mui-btn-block submit">完成</button>
				<!--<div class="mui-text-center">
					<input type="checkbox" class="orange-box" required /> <label class="red">我已阅读并同意联盟网条款</label>
				</div>-->
			</form>
		</div>
		<!-- 公告正文 end -->
	<script type="text/javascript" src="../../js/mui.min.js" ></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script src="../../js/mui.picker.js"></script>
	<script src="../../js/mui.poppicker.js"></script>
	<script src="../../js/city.data.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../js/loginTime.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
	    (function($, doc) {
			$.init({
			beforeback:function(){
				var loginview = plus.webview.getWebviewById('center/center_index.html');
				var recview = plus.webview.getWebviewById('jiaoyu.html');
				var recview1 = plus.webview.getWebviewById('feijiaoyu.html');
				var unitview = plus.webview.getWebviewById('units/unit_index.html');
				var peachview = plus.webview.getWebviewById('peach_list.html');
				recview.reload(true);
				recview1.reload(true);
				unitview.reload(true);
				loginview.reload(true);
				if(peachview){
					peachview.reload(true);
				}
				return true;
			}
		});
			$.ready(function() {
				//省市联动
				var cityPicker = new $.PopPicker({
					layer: 2
				});
				cityPicker.setData(cityData);
				var showCityPickerButton = doc.getElementById('showCityPicker');
				var cityResult = doc.getElementById('cityResult');
				showCityPickerButton.addEventListener('tap', function(event) {
					cityPicker.show(function(items) {
						showCityPickerButton.innerHTML = items[1].text;
						document.getElementById("cityResult").innerHTML = items[1].text;
					
					});
				}, false);
						
			});
		})(mui, document);
		
		
		mui('#type1').on('tap','button',function(){
			if(this.value==1){
				var form = document.getElementById("user1");
				var userType = 1;
			}else if(this.value==2){
				var form = document.getElementById("user2");
				var userType = 2;
			}
//			var form = document.getElementById("user1");
			var username = form.username.value;
			var password = form.password.value;
			plus.nativeUI.showWaiting();
			mui.ajax('http://www.dsjyw.net/mobile/login/login',{
				data:{username:username,password:password,userType:1},
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:10000,//超时时间设置为10秒；
				headers:{'Content-Type':'application/json'},	              
				success:function(data){
					if(!data.code){
//						window.localStorage.setItem('user_id',data.user_id);
                        setLogin('user_id',data.user_id);
                        window.localStorage.setItem('user_type',1);
					}else if(data.code==2){
						
					}else{
						plus.nativeUI.closeWaiting();
						alert('登陆失败，请检查学号和密码');
					}
					plus.nativeUI.closeWaiting();
					mui.back();
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
//					console.log(type);
                    plus.nativeUI.closeWaiting();
                    alert(type);
				}
			});
		});
		
		mui('#type2').on('tap','button',function(){
			if(this.value==1){
				var form = document.getElementById("user1");
				var userType = 1;
			}else if(this.value==2){
				var form = document.getElementById("user2");
				var userType = 2;
			}
//			var form = document.getElementById("user1");
			var username = form.username.value;
			var password = form.password.value;
			plus.nativeUI.showWaiting();
			mui.ajax('http://www.dsjyw.net/mobile/login/login',{
				data:{username:username,password:password,userType:2},
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:10000,//超时时间设置为10秒；
				headers:{'Content-Type':'application/json'},	              
				success:function(data){
					if(!data.code){
//						window.localStorage.setItem('user_id',data.user_id);
                        setLogin('user_id',data.user_id);
                        window.localStorage.setItem('user_type',2);
                        plus.nativeUI.closeWaiting();
						mui.back();
					}else if(data.code==2){
						document.getElementById("login_content").style.display = 'none';
						document.getElementById("study_content").style.display = 'block';
						plus.nativeUI.closeWaiting();
						window.localStorage.setItem('tem_id',data.user_id);
						document.getElementById("J_username").value = data.username;
					}else{
						plus.nativeUI.closeWaiting();
						alert('登陆失败,账号密码错误或账号尚未激活');
						plus.nativeUI.closeWaiting();
//						mui.back();
					}
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
//					console.log(type);
                    plus.nativeUI.closeWaiting();
                    alert(type);
				}
			});
		});
		
		mui('#study_content').on('tap','button',function(){
			var form = document.getElementById("study_form");
            
            var user_id = window.localStorage.getItem('tem_id');
			var realname = form.username.value;
			var city_id = document.getElementById("cityResult").innerHTML;
			var school_name = form.school_name.value;
			var major_name = form.major_name.value;
			var deparment = form.deparment.value;
			var yearStart = form.yearStart.value;
			var yearEnd = form.yearEnd.value;
			
			var degree_list = document.getElementsByName("degree"); 
			var gender_list = document.getElementsByName("gender"); 
			for(i=0;i<degree_list.length;i++) 
			{ 
				if(degree_list[i].checked){
					var degree = degree_list[i].value;
				}
			} 
			for(i=0;i<gender_list.length;i++) 
			{ 
				if(gender_list[i].checked){
					var gender = gender_list[i].value;
				}
			} 
			
			plus.nativeUI.showWaiting();
			mui.ajax('http://www.dsjyw.net/mobile/login/deelMessage',{
				data:{realname:realname,user_id:user_id,city_id:city_id,gender:gender,school_name:school_name,
				      major_name:major_name,deparment:deparment,degree:degree,yearStart:yearStart,yearEnd:yearEnd
				},
				dataType:'json',//服务器返回json格式数据
				type:'post',//HTTP请求类型
				timeout:10000,//超时时间设置为10秒；
				headers:{'Content-Type':'application/json'},	              
				success:function(data){
					if(data.code==0){
						setLogin('user_id',data.user_id);
						plus.nativeUI.closeWaiting();
						mui.back();
					}
				},
				error:function(xhr,type,errorThrown){
					//异常处理；
//					console.log(type);
                    plus.nativeUI.closeWaiting();
                    alert(type);
				}
			});
		});
		
		var auths={};
		function plusReady(){
			// 获取登录认证通道
			plus.oauth.getServices(function(services){
				var content=document.getElementById('dcontent');
				for(var i in services){
					var service=services[i];
					auths[service.id]=service;
					var de = document.createElement('div');
					de.setAttribute('onclick','login(this.id)');
					de.id=service.id;
					de.setAttribute('class','oauth-btn');
					de.style.backgroundImage = 'url("../../img/center/' + service.id + '.jpg")';
					oauth.appendChild(de);
				}
			},function(e){
				outLine("获取登录认证失败："+e.message);
			});
		}
		document.addEventListener('plusready',plusReady,false);
		// 登录认证
		function login(id){
			outSet("----- 登录认证 -----");
			var auth=auths[id];
			if(auth){
				var w=null;
				if(plus.os.name=="Android"){
					w=plus.nativeUI.showWaiting();
				}
				document.addEventListener("pause",function(){
					setTimeout(function(){
						w&&w.close();w=null;
					},2000);
				}, false );
				auth.login(function(){
					w&&w.close();w=null;
					outLine("登录认证成功：");
					outLine(JSON.stringify(auth.authResult));
					userinfo(auth);
				},function(e){
					w&&w.close();w=null;
					outLine("登录认证失败：");
					outLine("["+e.code+"]："+e.message);
					plus.nativeUI.alert("详情错误信息请参考授权登录(OAuth)规范文档：http://www.html5plus.org/#specification#/specification/OAuth.html",null,"登录失败["+e.code+"]："+e.message);
				});
			}else{
				outLine("无效的登录认证通道！");
				plus.nativeUI.alert("无效的登录认证通道！",null,"登录");
			}
		}
		// 获取用户信息
		function userinfo(a){
			outLine("----- 获取用户信息 -----");
			a.getUserInfo(function(){
				outLine("获取用户信息成功：");
				outLine(JSON.stringify(a.userInfo));
				var nickname=a.userInfo.nickname||a.userInfo.name;
				plus.nativeUI.alert("欢迎“"+nickname+"”登录！");
			});
		}
		
		
		mui('#type2').on('tap', 'a', function() {
				var id = this.getAttribute('href');
				var href = this.href;
				var type = this.getAttribute('open-type');
				if (type == "common") {
					var webview_style = {
						popGesture: "close"
					};
			
					mui.openWindow({
						id: id,
						url: this.href,
						styles: webview_style,
						show: {
							aniShow: "pop-in",
							duration:300,
							autoShow:true
						},
						waiting: {
							autoShow: false
						}
					});
				}
			});
			
		
	</script>
	</body>
	
</html>